<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DOC - Windows 11 Jailer UI</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Segoe+UI:wght@300;400;500;600;700&display=swap');
    
    :root {
      --bg: #202020;
      --surface: rgba(43, 43, 43, 0.7);
      --surface-solid: #2b2b2b;
      --title-bg: rgba(255, 255, 255, 0.08);
      --accent: #0078d4;
      --accent-light: #4ca4e8;
      --text: #ffffff;
      --text-secondary: #cccccc;
      --border: rgba(255, 255, 255, 0.1);
      --border-light: rgba(255, 255, 255, 0.06);
      --shadow: rgba(0, 0, 0, 0.3);
      --taskbar-bg: rgba(32, 32, 32, 0.85);
      --start-menu-bg: rgba(43, 43, 43, 0.98);
      --hover-bg: rgba(255, 255, 255, 0.08);
      --active-bg: rgba(255, 255, 255, 0.12);
      --card-bg: rgba(255, 255, 255, 0.05);
      --mica-bg: rgba(32, 32, 32, 0.8);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Segoe UI Variable', sans-serif;
      user-select: none;
      -webkit-font-smoothing: antialiased;
    }

    body {
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://wallpaperaccess.com/full/2825704.gif') center/cover no-repeat;
      overflow: hidden;
      display: none;
      height: 100vh;
      color: var(--text);
    }

    .desktop {
      position: fixed;
      inset: 0;
      display: grid;
      grid-template-columns: repeat(auto-fill, 80px);
      grid-template-rows: repeat(auto-fill, 80px);
      padding: 20px;
      gap: 20px;
    }

    .desktop-icon {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 80px;
      height: 80px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      padding: 8px;
    }

    .desktop-icon:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
    }

    .desktop-icon:active {
      transform: translateY(0);
      transition: transform 0.1s;
    }

    .desktop-icon i {
      font-size: 32px;
      margin-bottom: 8px;
      transition: transform 0.2s cubic-bezier(0.33, 0, 0, 1);
    }

    .desktop-icon:hover i {
      transform: scale(1.1);
    }

    .desktop-icon div {
      text-align: center;
      font-size: 12px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    }

    /* Window styling */
    .window {
      position: absolute;
      width: 800px;
      height: 600px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 9px;
      backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 0 8px 32px var(--shadow);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.33, 0, 0, 1);
      z-index: 100;
      opacity: 0;
      transform: scale(0.95);
    }

    .window.visible {
      opacity: 1;
      transform: scale(1);
    }

    .window.hidden {
      display: none;
    }

    .window.maximized {
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      border-radius: 0;
      transition: all 0.3s cubic-bezier(0.33, 0, 0, 1);
    }

    .title-bar {
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      background: var(--title-bg);
      cursor: grab;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      flex-shrink: 0;
      font-size: 13px;
      transition: background 0.2s;
    }

    .title-bar.grabbing {
      cursor: grabbing;
      background: rgba(255, 255, 255, 0.12);
    }

    .title {
      color: var(--text);
      font-weight: 500;
    }

    .controls {
      display: flex;
      gap: 4px;
    }

    .controls button {
      background: none;
      border: none;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      color: var(--text);
      font-size: 12px;
    }

    .controls button:hover {
      background: var(--hover-bg);
    }

    .controls .minimize:hover {
      background: var(--hover-bg);
    }

    .controls .maximize:hover {
      background: var(--hover-bg);
    }

    .controls .close:hover {
      background: #e81123;
      color: #fff;
    }

    .content {
      flex: 1;
      padding: 16px;
      overflow: auto;
      color: var(--text);
    }

    /* Form elements */
    .form-row {
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
    }

    label {
      margin-bottom: 8px;
      font-size: 0.9em;
      color: var(--text-secondary);
    }

    input, select, button {
      font: inherit;
    }

    input, select {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: rgba(30, 30, 30, 0.5);
      color: var(--text);
      outline: none;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
    }

    button.primary {
      margin-top: 12px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      font-weight: 500;
      align-self: flex-start;
    }

    button.primary:hover {
      background: var(--accent-light);
      transform: translateY(-1px);
    }

    button.primary:active {
      transform: translateY(0);
    }

    .error {
      color: #ff5f56;
      margin-bottom: 12px;
      display: none;
      padding: 10px 12px;
      background: rgba(255, 95, 86, 0.1);
      border-radius: 6px;
      border-left: 3px solid #ff5f56;
      transition: all 0.3s ease;
    }

    /* Taskbar styling */
    .taskbar {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 48px;
      background: var(--taskbar-bg);
      display: flex;
      align-items: center;
      padding: 0 12px;
      gap: 6px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      flex-shrink: 0;
      backdrop-filter: blur(10px);
      z-index: 1000;
      justify-content: center;
    }

    .taskbar-center {
      display: flex;
      align-items: center;
      gap: 6px;
      height: 100%;
    }

    .taskbar .icon {
      width: 42px;
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      position: relative;
    }

    .taskbar .icon:hover {
      background: var(--hover-bg);
    }

    .taskbar .icon.active {
      background: var(--active-bg);
    }

    .taskbar .icon.active::before {
      content: '';
      position: absolute;
      height: 2px;
      width: 20px;
      background: var(--accent);
      bottom: 6px;
      border-radius: 10px;
    }

    .taskbar .icon i {
      font-size: 16px;
    }

    .taskbar .spacer {
      flex: 1;
    }

    .system-tray {
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text);
      font-size: 12px;
      padding-right: 8px;
      height: 100%;
    }

    .system-tray-item {
      padding: 6px 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .system-tray-item:hover {
      background: var(--hover-bg);
    }

    .system-tray i {
      font-size: 14px;
    }

    /* Start menu */
    .start-menu {
      position: absolute;
      bottom: 52px;
      left: 50%;
      transform: translateX(-50%);
      width: 520px;
      height: 600px;
      background: var(--start-menu-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      backdrop-filter: blur(40px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
      display: none;
      z-index: 999;
      overflow: hidden;
      opacity: 0;
      transform: translate(-50%, 20px) scale(0.95);
      transition: all 0.3s cubic-bezier(0.33, 0, 0, 1);
    }

    .start-menu.active {
      display: flex;
      opacity: 1;
      transform: translate(-50%, 0) scale(1);
    }

    .start-menu-sidebar {
      width: 60px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px 0;
      gap: 16px;
    }

    .start-menu-sidebar .icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .start-menu-sidebar .icon:hover {
      background: var(--hover-bg);
    }

    .start-menu-main {
      flex: 1;
      padding: 24px;
    }

    .start-menu-main h3 {
      margin-bottom: 16px;
      font-weight: 500;
      color: var(--text);
    }

    .start-menu-apps {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .start-menu-app {
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
    }

    .start-menu-app:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
    }

    .start-menu-app i {
      margin-right: 12px;
      font-size: 16px;
    }

    /* Browser specific styles */
    .browser-navbar {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: var(--title-bg);
      gap: 8px;
    }

    .browser-nav-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .browser-nav-btn:hover {
      background: var(--hover-bg);
    }

    .browser-nav-btn.disabled {
      opacity: 0.35;
      pointer-events: none;
    }

    .browser-url-bar {
      flex: 1;
      display: flex;
      align-items: center;
      background: rgba(30, 30, 30, 0.5);
      border-radius: 6px;
      padding: 0 12px;
      height: 32px;
      gap: 8px;
    }

    .browser-url-bar i {
      color: #8a8a8a;
      font-size: 12px;
    }

    .browser-url-input {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--text);
      height: 100%;
      padding: 0;
    }

    /* New browser content area (replaces iframe) */
    .browser-content {
      width: 100%;
      height: calc(100% - 76px);
      border: none;
      background: rgba(255,255,255,0.02);
      overflow: auto;
      padding: 12px;
      color: var(--text);
      position: relative;
    }

    .browser-loading {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,0.6);
      padding: 12px 16px;
      border-radius: 6px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      display: none;
      z-index: 2000;
      color: var(--text);
    }

    /* Case search table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
      background: var(--card-bg);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-light);
    }

    th {
      background: rgba(255, 255, 255, 0.05);
      font-weight: 500;
      color: var(--text-secondary);
    }

    tr:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    /* File explorer */
    .explorer-sidebar {
      width: 200px;
      background: rgba(30, 30, 30, 0.4);
      padding: 16px 0;
      border-right: 1px solid var(--border-light);
    }

    .explorer-sidebar-item {
      padding: 10px 16px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background 0.2s;
      color: var(--text-secondary);
    }

    .explorer-sidebar-item:hover {
      background: var(--hover-bg);
      color: var(--text);
    }

    .explorer-sidebar-item i {
      margin-right: 12px;
      font-size: 14px;
    }

    .explorer-content {
      flex: 1;
      padding: 16px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      align-content: flex-start;
    }

    .file-item {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      background: var(--card-bg);
    }

    .file-item:hover {
      background: var(--hover-bg);
      transform: translateY(-2px);
    }

    .file-item:active {
      transform: translateY(0);
    }

    .file-item i {
      font-size: 24px;
      margin-bottom: 8px;
      display: block;
    }

    /* Settings app */
    .settings-category {
      margin-bottom: 24px;
    }

    .settings-category h3 {
      margin-bottom: 12px;
      font-weight: 500;
    }

    .wallpaper-options {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .wallpaper-option {
      height: 80px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.33, 0, 0, 1);
      background-size: cover;
      background-position: center;
      border: 2px solid transparent;
    }

    .wallpaper-option:hover {
      transform: scale(1.05);
      border-color: var(--accent);
    }

    .wallpaper-option.active {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.3);
    }

    /* Notification panel */
    .notification-panel {
      position: absolute;
      bottom: 52px;
      right: 12px;
      width: 360px;
      height: 500px;
      background: var(--start-menu-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      backdrop-filter: blur(40px);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.4);
      display: none;
      z-index: 999;
      overflow: hidden;
      opacity: 0;
      transform: translateY(20px) scale(0.95);
      transition: all 0.3s cubic-bezier(0.33, 0, 0, 1);
      flex-direction: column;
    }

    .notification-panel.active {
      display: flex;
      opacity: 1;
      transform: translateY(0) scale(1);
    }

    .notification-header {
      padding: 16px;
      border-bottom: 1px solid var(--border-light);
      font-weight: 600;
    }

    .notification-content {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
    }

    .quick-settings {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .quick-setting {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
      background: var(--card-bg);
    }

    .quick-setting:hover {
      background: var(--hover-bg);
    }

    .quick-setting i {
      font-size: 20px;
      margin-bottom: 8px;
    }

    .volume-slider {
      width: 100%;
      margin: 16px 0;
    }

    /* Calendar */
    .calendar {
      margin-top: 20px;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .calendar-day {
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      cursor: pointer;
    }

    .calendar-day:hover {
      background: var(--hover-bg);
    }

    .calendar-day.today {
      background: var(--accent);
      color: white;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Windows 11 specific animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes scaleIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    /* Focus styles for accessibility */
    button:focus-visible, input:focus-visible, select:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="desktop">
    <!-- Desktop Icons -->
    <div class="desktop-icon" data-launch="jailerApp">
      <i class="fas fa-lock"></i>
      <div>Jailer</div>
    </div>
    <div class="desktop-icon" data-launch="caseSearchApp">
      <i class="fas fa-search"></i>
      <div>Case Search</div>
    </div>
    <div class="desktop-icon" data-launch="explorerApp">
      <i class="fas fa-folder"></i>
      <div>Explorer</div>
    </div>
    <div class="desktop-icon" data-launch="browserApp">
      <i class="fab fa-internet-explorer"></i>
      <div>Internet Explorer</div>
    </div>
    <div class="desktop-icon" data-launch="settingsApp">
      <i class="fas fa-cog"></i>
      <div>Settings</div>
    </div>

    <!-- Jailer Window -->
    <div class="window hidden" id="jailerApp" style="top: 100px; left: 100px;">
      <div class="title-bar" data-win="jailerApp">
        <div class="title">DOC - Jail Management</div>
        <div class="controls">
          <button class="minimize"><i class="fas fa-minus"></i></button>
          <button class="maximize"><i class="fas fa-square"></i></button>
          <button class="close"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="content">
        <div id="jailError" class="error"></div>
        <div class="form-row">
          <label for="targetId">Inmate ID</label>
          <input type="number" id="targetId" placeholder="Enter inmate ID">
        </div>
        <div class="form-row">
          <label>Duration</label>
          <div style="display:flex;gap:8px;">
            <input type="number" id="time" value="5" style="flex:1;">
            <select id="unit">
              <option value="minutes">Minutes</option>
              <option value="hours">Hours</option>
              <option value="days">Days</option>
            </select>
          </div>
        </div>
        <div id="chargesContainer" class="form-row"></div>
        <button class="primary" id="submitJailBtn">Commit to Custody</button>
      </div>
    </div>

    <!-- Case Search Window -->
    <div class="window hidden" id="caseSearchApp" style="top: 150px; left: 150px;">
      <div class="title-bar" data-win="caseSearchApp">
        <div class="title">NCIC Case Search</div>
        <div class="controls">
          <button class="minimize"><i class="fas fa-minus"></i></button>
          <button class="maximize"><i class="fas fa-square"></i></button>
          <button class="close"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="content">
        <div id="caseError" class="error"></div>
        <div class="form-row">
          <label for="searchId">User ID</label>
          <input type="number" id="searchId" placeholder="Enter target ID…">
        </div>
        <button class="primary" id="searchBtn"><i class="fas fa-search"></i> Search</button>
        <div id="resultsSection" class="form-row" style="display:none;">
          <h3>Search Results</h3>
          <table id="resultsTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time (min)</th>
                <th>Charges</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Explorer Window -->
    <div class="window hidden" id="explorerApp" style="top: 200px; left: 200px;">
      <div class="title-bar" data-win="explorerApp">
        <div class="title">File Explorer</div>
        <div class="controls">
          <button class="minimize"><i class="fas fa-minus"></i></button>
          <button class="maximize"><i class="fas fa-square"></i></button>
          <button class="close"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div style="display:flex;height:100%;">
        <div class="explorer-sidebar">
          <div class="explorer-sidebar-item">
            <i class="fas fa-desktop"></i>
            <span>Desktop</span>
          </div>
          <div class="explorer-sidebar-item">
            <i class="fas fa-documents"></i>
            <span>Documents</span>
          </div>
          <div class="explorer-sidebar-item">
            <i class="fas fa-images"></i>
            <span>Pictures</span>
          </div>
          <div class="explorer-sidebar-item">
            <i class="fas fa-download"></i>
            <span>Downloads</span>
          </div>
        </div>
        <div class="explorer-content">
          <div class="file-item">
            <i class="fas fa-file-alt"></i>
            <div>Document.docx</div>
          </div>
          <div class="file-item">
            <i class="fas fa-file-pdf"></i>
            <div>Report.pdf</div>
          </div>
          <div class="file-item">
            <i class="fas fa-file-image"></i>
            <div>Image.png</div>
          </div>
          <div class="file-item">
            <i class="fas fa-folder"></i>
            <div>Cases</div>
          </div>
          <div class="file-item">
            <i class="fas fa-folder"></i>
            <div>Evidence</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Browser Window (Internet Explorer) -->
    <div class="window hidden" id="browserApp" style="top: 250px; left: 250px;">
      <div class="title-bar" data-win="browserApp">
        <div class="title">Internet Explorer</div>
        <div class="controls">
          <button class="minimize"><i class="fas fa-minus"></i></button>
          <button class="maximize"><i class="fas fa-square"></i></button>
          <button class="close"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="browser-navbar">
        <div id="btnBack" class="browser-nav-btn disabled" title="Back"><i class="fas fa-arrow-left"></i></div>
        <div id="btnForward" class="browser-nav-btn disabled" title="Forward"><i class="fas fa-arrow-right"></i></div>
        <div id="btnRefresh" class="browser-nav-btn" title="Refresh"><i class="fas fa-redo"></i></div>
        <div id="btnHome" class="browser-nav-btn" title="Home"><i class="fas fa-home"></i></div>
        <div class="browser-url-bar">
          <i class="fas fa-lock"></i>
          <input type="text" id="browserUrl" placeholder="https://example.com" class="browser-url-input" spellcheck="false">
        </div>
        <div id="btnSearch" class="browser-nav-btn" title="Go / Search"><i class="fas fa-search"></i></div>
      </div>

      <!-- Replaced iframe with an in-page browser rendering area -->
      <div id="browserContent" class="browser-content" role="region" aria-label="Browser content"></div>
      <div id="browserLoader" class="browser-loading">Loading…</div>
      <div id="browserNotice" style="position:absolute;top:44px;left:12px;color:#cfcfcf;font-size:12px;display:none;z-index:1500;background:rgba(0,0,0,0.45);padding:6px;border-radius:6px;">Rendered via proxy</div>
    </div>

    <!-- Settings Window -->
    <div class="window hidden" id="settingsApp" style="top: 300px; left: 300px;">
      <div class="title-bar" data-win="settingsApp">
        <div class="title">Settings</div>
        <div class="controls">
          <button class="minimize"><i class="fas fa-minus"></i></button>
          <button class="maximize"><i class="fas fa-square"></i></button>
          <button class="close"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="content">
        <div class="settings-category">
          <h3>Personalization</h3>
          <label>Choose Wallpaper</label>
          <div class="wallpaper-options">
            <div class="wallpaper-option" data-wall="https://wallpaperaccess.com/full/2825704.gif" style="background-image: url('https://wallpaperaccess.com/full/2825704.gif')"></div>
            <div class="wallpaper-option" data-wall="https://wallpaperaccess.com/full/835991.jpg" style="background-image: url('https://wallpaperaccess.com/full/835991.jpg')"></div>
            <div class="wallpaper-option" data-wall="https://wallpaperaccess.com/full/2825714.gif" style="background-image: url('https://wallpaperaccess.com/full/2825714.gif')"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Start Menu -->
  <div class="start-menu" id="startMenu">
    <div class="start-menu-sidebar">
      <div class="icon"><i class="fas fa-user"></i></div>
      <div class="icon"><i class="fas fa-cog"></i></div>
      <div class="icon"><i class="fas fa-power-off"></i></div>
    </div>
    <div class="start-menu-main">
      <h3>Applications</h3>
      <div class="start-menu-apps">
        <div class="start-menu-app" data-launch="jailerApp">
          <i class="fas fa-lock"></i>
          <span>Jailer</span>
        </div>
        <div class="start-menu-app" data-launch="caseSearchApp">
          <i class="fas fa-search"></i>
          <span>Case Search</span>
        </div>
        <div class="start-menu-app" data-launch="explorerApp">
          <i class="fas fa-folder"></i>
          <span>File Explorer</span>
        </div>
        <div class="start-menu-app" data-launch="browserApp">
          <i class="fab fa-internet-explorer"></i>
          <span>Internet Explorer</span>
        </div>
        <div class="start-menu-app" data-launch="settingsApp">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Panel -->
  <div class="notification-panel" id="notificationPanel">
    <div class="notification-header">Notifications</div>
    <div class="notification-content">
      <div class="quick-settings">
        <div class="quick-setting">
          <i class="fas fa-wifi"></i>
          <span>Wi-Fi</span>
        </div>
        <div class="quick-setting">
          <i class="fas fa-bluetooth-b"></i>
          <span>Bluetooth</span>
        </div>
        <div class="quick-setting">
          <i class="fas fa-plane"></i>
          <span>Airplane Mode</span>
        </div>
        <div class="quick-setting">
          <i class="fas fa-moon"></i>
          <span>Focus Assist</span>
        </div>
        <div class="quick-setting">
          <i class="fas fa-battery-full"></i>
          <span>Battery Saver</span>
        </div>
        <div class="quick-setting">
          <i class="fas fa-map-marker-alt"></i>
          <span>Location</span>
        </div>
      </div>
      
      <div class="volume-slider">
        <label>Volume</label>
        <input type="range" min="0" max="100" value="75" style="width: 100%">
      </div>
      
      <div class="brightness-slider">
        <label>Brightness</label>
        <input type="range" min="0" max="100" value="80" style="width: 100%">
      </div>
      
      <div class="calendar">
        <div class="calendar-header">
          <span>September 2023</span>
          <div>
            <button><i class="fas fa-chevron-left"></i></button>
            <button><i class="fas fa-chevron-right"></i></button>
          </div>
        </div>
        <div class="calendar-grid">
          <!-- Calendar days would be populated here -->
          <div class="calendar-day">S</div>
          <div class="calendar-day">M</div>
          <div class="calendar-day">T</div>
          <div class="calendar-day">W</div>
          <div class="calendar-day">T</div>
          <div class="calendar-day">F</div>
          <div class="calendar-day">S</div>
          <!-- More days... -->
        </div>
      </div>
    </div>
  </div>

  <!-- Taskbar -->
  <div class="taskbar">
    <div class="taskbar-center">
      <div class="icon" id="startBtn">
        <i class="fab fa-windows"></i>
      </div>
      <div class="icon" data-launch="jailerApp">
        <i class="fas fa-lock"></i>
      </div>
      <div class="icon" data-launch="caseSearchApp">
        <i class="fas fa-search"></i>
      </div>
      <div class="icon" data-launch="explorerApp">
        <i class="fas fa-folder"></i>
      </div>
      <div class="icon" data-launch="browserApp">
        <i class="fab fa-internet-explorer"></i>
      </div>
    </div>
    <div class="system-tray">
      <div class="system-tray-item" id="notificationBtn">
        <i class="fas fa-comment-alt"></i>
        <span id="clock-time">00:00</span>
      </div>
      <div class="system-tray-item">
        <i class="fas fa-wifi"></i>
      </div>
      <div class="system-tray-item">
        <i class="fas fa-volume-up"></i>
      </div>
    </div>
  </div>

  <script src="config.js"></script>
  <script>
    // improved resource name detection (use GetParentResourceName in NUI, fallback for dev)
    const resourceName = (typeof GetParentResourceName === 'function' && GetParentResourceName()) ? GetParentResourceName() : (window.__DEV_RESOURCE__ || 'jailer');

    const sendCloseToClient = () => {
      fetch(`https://${resourceName}/close`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({})
      }).catch(() => {});
    };

    // UI helpers (kept from your original)
    const windows = document.querySelectorAll('.window');

    document.addEventListener('keydown', e => {
      const isEsc = e.key === 'Escape' || e.code === 'Escape' || e.keyCode === 27;
      if (!isEsc) return;
      document.getElementById('startMenu').classList.remove('active');
      document.getElementById('notificationPanel').classList.remove('active');
      windows.forEach(w => w.classList.add('hidden'));
      document.body.style.display = 'none';
      sendCloseToClient();
    });

    document.querySelectorAll('.title-bar').forEach(bar => {
      const win = document.getElementById(bar.dataset.win);
      let down=false, x0=0, y0=0;
      bar.addEventListener('mousedown', e => { down=true; bar.classList.add('grabbing'); x0 = e.clientX - (win.offsetLeft||0); y0 = e.clientY - (win.offsetTop||0); });
      document.addEventListener('mousemove', e => { if(!down) return; win.style.left = `${e.clientX - x0}px`; win.style.top = `${e.clientY - y0}px`; });
      document.addEventListener('mouseup', () => { down=false; bar.classList.remove('grabbing'); });
    });

    document.querySelectorAll('.controls button').forEach(btn => {
      const win = btn.closest('.window');
      btn.addEventListener('click', () => {
        if (btn.classList.contains('minimize')) {
          win.classList.add('hidden');
          const anyVisible = [...document.querySelectorAll('.window')].some(w => !w.classList.contains('hidden'));
          if (!anyVisible) document.body.style.display = 'none';
        }
        if (btn.classList.contains('maximize')) win.classList.toggle('maximized');
        if (btn.classList.contains('close')) {
          win.classList.add('hidden');
          const anyVisible = [...document.querySelectorAll('.window')].some(w => !w.classList.contains('hidden'));
          if (!anyVisible) { document.body.style.display = 'none'; sendCloseToClient(); }
        }
      });
    });

    document.querySelectorAll('[data-launch]').forEach(el => {
      el.addEventListener('click', () => {
        const id = el.dataset.launch;
        const w = document.getElementById(id);
        if (!w) return;
        w.classList.remove('hidden');
        w.classList.add('visible');
        w.style.zIndex = Date.now();
        document.body.style.display = 'block';
      });
    });

    document.getElementById('startBtn').onclick = (e) => { 
      e.stopPropagation(); 
      document.getElementById('startMenu').classList.toggle('active');
      document.getElementById('notificationPanel').classList.remove('active');
    };
    
    document.getElementById('notificationBtn').onclick = (e) => { 
      e.stopPropagation(); 
      document.getElementById('notificationPanel').classList.toggle('active');
      document.getElementById('startMenu').classList.remove('active');
    };
    
    document.addEventListener('click', (e) => { 
      if (!e.target.closest('#startMenu') && !e.target.closest('#startBtn')) {
        document.getElementById('startMenu').classList.remove('active');
      }
      if (!e.target.closest('#notificationPanel') && !e.target.closest('#notificationBtn')) {
        document.getElementById('notificationPanel').classList.remove('active');
      }
    });
    
    document.querySelectorAll('#startMenu [data-launch]').forEach(li => { 
      li.onclick = e => { 
        e.stopPropagation(); 
        document.getElementById('startMenu').classList.remove('active'); 
        document.querySelector(`[data-launch="${li.dataset.launch}"]`).click(); 
      }; 
    });

    // NUI message handler
    window.addEventListener('message', ({ data }) => {
      if (!data || !data.action) return;
      if (data.action === 'open') {
        document.body.style.display = 'block';
        const el = document.getElementById('jailerApp');
        if (el) { 
          el.classList.remove('hidden'); 
          el.classList.add('visible');
          el.style.zIndex = Date.now(); 
        }
      }
      if (data.action === 'openCaseSearch') {
        document.body.style.display = 'block';
        const el = document.getElementById('caseSearchApp'); 
        if (el) { 
          el.classList.remove('hidden'); 
          el.classList.add('visible');
          el.style.zIndex = Date.now(); 
        }
      }
      if (data.action === 'close') { 
        windows.forEach(w => w.classList.add('hidden')); 
        document.body.style.display = 'none'; 
      }
      if (data.action === 'jailError') { 
        const e = document.getElementById('jailError'); 
        e.textContent = data.message || 'Unknown error'; 
        e.style.display = 'block'; 
      }
      if (data.action === 'caseRecords') {
        const tbody = document.querySelector('#resultsTable tbody'); 
        tbody.innerHTML = '';
        const records = (data.records && data.records.length) ? data.records : [{ date: '—', time_minutes: '—', charges: 'No records' }];
        records.forEach(r => { 
          const tr = document.createElement('tr'); 
          tr.innerHTML = `<td>${r.date}</td><td>${r.time_minutes}</td><td>${r.charges}</td>`; 
          tbody.appendChild(tr); 
        });
        document.getElementById('resultsSection').style.display = 'block';
      }
      if (data.action === 'open' && window.chargeCategories) {
        const c = document.getElementById('chargesContainer');
        if (!c.hasChildNodes()) {
          Object.entries(window.chargeCategories).forEach(([cat, list]) => {
            const det = document.createElement('details');
            det.innerHTML = `<summary>${cat}</summary><div>` + list.map(ch => `<label style="display:block;margin:6px 0;"><input type="checkbox" value="${ch}"/> ${ch}</label>`).join('') + `</div>`;
            c.append(det);
          });
        }
      }
    });

    // Submit / Search handlers
    document.getElementById('submitJailBtn').onclick = () => {
      document.getElementById('jailError').style.display = 'none';
      const targetId = +document.getElementById('targetId').value;
      let t = +document.getElementById('time').value;
      const unit = document.getElementById('unit').value;
      if (unit === 'hours') t *= 60; if (unit === 'days') t *= 1440;
      const charges = [...document.querySelectorAll('#chargesContainer input:checked')].map(i => i.value);
      fetch(`https://${resourceName}/submitJail`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ targetId, time: t, charges }) }).catch(err => console.warn('submitJail POST failed', err));
    };

    document.getElementById('searchBtn').onclick = () => {
      document.getElementById('caseError').style.display = 'none';
      const uid = +document.getElementById('searchId').value;
      if (!uid) { const e = document.getElementById('caseError'); e.textContent = 'Invalid User ID'; e.style.display = 'block'; return; }
      fetch(`https://${resourceName}/fetchCases`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ userId: uid }) }).catch(err => console.warn('fetchCases POST failed', err));
    };

    // Browser functionality (no iframe)
    const browserContent = document.getElementById('browserContent');
    const browserLoader = document.getElementById('browserLoader');
    const browserUrlInput = document.getElementById('browserUrl');
    const btnBack = document.getElementById('btnBack');
    const btnForward = document.getElementById('btnForward');
    const btnRefresh = document.getElementById('btnRefresh');
    const btnHome = document.getElementById('btnHome');
    const btnSearch = document.getElementById('btnSearch');
    const browserNotice = document.getElementById('browserNotice');

    const historyStack = [];
    let historyPos = -1;
    let currentUrl = '';

    function sanitizeHTML(raw) {
      if (!raw) return '';
      raw = raw.replace(/<script[\s\S]*?>[\s\S]*?<\/script>/gi, '');
      raw = raw.replace(/href\s*=\s*["']\s*javascript:[^"']*["']/gi, 'href="#"');
      raw = raw.replace(/\son\w+\s*=\s*(['"])[\s\S]*?\1/gi, '');
      raw = raw.replace(/<meta[^>]*http-equiv=["']?refresh["']?[^>]*>/gi, '');
      return raw;
    }

    function setLoading(on) { browserLoader.style.display = on ? 'block' : 'none'; }
    function updateNavButtons() { btnBack.classList.toggle('disabled', historyPos <= 0); btnForward.classList.toggle('disabled', historyPos >= historyStack.length - 1 || historyPos === -1); }

    async function fetchPage(url) {
      setLoading(true);
      try {
        const res = await fetch(`https://${resourceName}/browserFetch`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ url }) });
        const data = await res.json().catch(() => null);
        setLoading(false);
        return data;
      } catch (err) {
        setLoading(false);
        console.warn('browserFetch failed', err);
        return { success:false, error: 'Network error' };
      }
    }

    async function navigateTo(rawUrl, addToHistory = true) {
      if (!rawUrl) return;
      let url = rawUrl.trim();
      const looksLikeUrl = /^[a-zA-Z]+:\/\//.test(url) || /^[\w\.\-]+\.[a-z]{2,6}/i.test(url);
      if (!looksLikeUrl) {
        url = `https://duckduckgo.com/?q=${encodeURIComponent(url)}`;
      } else if (!/^[a-zA-Z]+:\/\//.test(url)) {
        url = 'https://' + url;
      }

      browserUrlInput.value = url;
      browserNotice.style.display = 'none';

      const data = await fetchPage(url);

      if (!data || !data.success) {
        const err = data && data.error ? data.error : 'Unknown error';
        browserContent.innerHTML = `<div style="padding:12px;color:var(--text)"><strong>Failed to load page.</strong><div style="margin-top:8px;color:#ccc;">${err}</div></div>`;
        currentUrl = url;
        if (addToHistory) { historyStack.splice(historyPos + 1); historyStack.push(url); historyPos++; }
        updateNavButtons();
        return;
      }

      if (data.fromProxy) {
        browserNotice.style.display = 'block';
        browserNotice.textContent = 'Rendered via proxy';
      } else {
        browserNotice.style.display = 'none';
      }

      const sanitized = sanitizeHTML(data.html || '');
      browserContent.innerHTML = sanitized || '<div style="padding:12px;color:var(--text)">No content</div>';

      if (data.title) {
        const titleEl = document.querySelector('#browserApp .title');
        if (titleEl) titleEl.textContent = `Internet Explorer — ${data.title}`;
      }

      currentUrl = data.url || url;
      if (addToHistory) { historyStack.splice(historyPos + 1); historyStack.push(currentUrl); historyPos++; }
      browserUrlInput.value = currentUrl;
      updateNavButtons();
      interceptLinksInContent();
    }

    function interceptLinksInContent() {
      try { browserContent.removeEventListener('click', contentClickHandler); } catch(e) {}
      browserContent.addEventListener('click', contentClickHandler);
    }

    function contentClickHandler(e) {
      const a = e.target.closest('a');
      if (!a) return;
      const href = a.getAttribute('href') || '';
      if (/^\s*javascript:/i.test(href)) { e.preventDefault(); return; }
      e.preventDefault();
      try {
        let newUrl;
        if (/^[a-zA-Z]+:\/\//.test(href)) newUrl = href;
        else { const base = currentUrl || browserUrlInput.value || 'https://'; newUrl = new URL(href, base).toString(); }
        navigateTo(newUrl, true);
      } catch (err) { console.warn('Failed resolving link', err); }
    }

    // nav handlers
    btnBack.addEventListener('click', () => { if (historyPos <= 0) return; historyPos--; navigateTo(historyStack[historyPos], false); updateNavButtons(); });
    btnForward.addEventListener('click', () => { if (historyPos >= historyStack.length - 1) return; historyPos++; navigateTo(historyStack[historyPos], false); updateNavButtons(); });
    btnRefresh.addEventListener('click', () => { if (!currentUrl) return; navigateTo(currentUrl, false); });
    btnHome.addEventListener('click', () => { browserContent.innerHTML = '<div style="padding:12px;color:var(--text)">Home</div>'; browserUrlInput.value = ''; currentUrl = ''; historyStack.splice(historyPos + 1); historyStack.push('about:blank'); historyPos++; updateNavButtons(); });
    btnSearch.addEventListener('click', () => { const v = browserUrlInput.value.trim(); if (v) navigateTo(v, true); });
    browserUrlInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') navigateTo(e.target.value, true); });

    // wallpaper & clock & onload restore (same as before)
    document.querySelectorAll('.wallpaper-option').forEach(el => { 
      el.onclick = () => { 
        document.body.style.background = `url('${el.dataset.wall}') center/cover no-repeat`; 
        localStorage.setItem('bg', el.dataset.wall); 
        document.querySelectorAll('.wallpaper-option').forEach(opt => opt.classList.remove('active'));
        el.classList.add('active');
      }; 
    });
    
    setInterval(() => { 
      document.getElementById('clock-time').textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }); 
    }, 1000);
    
    window.onload = () => { 
      const w = localStorage.getItem('bg'); 
      if (w) {
        document.body.style.background = `url('${w}') center/cover no-repeat`;
        document.querySelectorAll('.wallpaper-option').forEach(opt => {
          if (opt.dataset.wall === w) opt.classList.add('active');
        });
      }
    };

    function cleanupContentHandlers() { try { browserContent.removeEventListener('click', contentClickHandler); } catch(e) {} }
    window._nui_browser = { navigateTo, historyStack, getCurrentUrl: () => currentUrl };
    window.addEventListener('unload', cleanupContentHandlers);
  </script>
</body>
</html>